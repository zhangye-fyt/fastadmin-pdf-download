!function(c){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.repeater=redux.field_objects.repeater||{},c(document).ready(function(){}),redux.field_objects.repeater.sort_repeaters=function(e){(e=!e.hasClass("redux-container-repeater")?e.parents(".redux-container-repeater:first"):e).find(".redux-repeater-accordion-repeater").each(function(e){var r=c(this).attr("data-sortid");c(this).find("input[name*='["+r+"]']").each(function(){c(this).attr("name",c(this).attr("name").replace("["+r+"]","["+e+"]"))}),c(this).find("select[name*='["+r+"]']").each(function(){c(this).attr("name",c(this).attr("name").replace("["+r+"]","["+e+"]"))}),c(this).attr("data-sortid",e);var t=c(this).find(".ui-accordion-header"),a=t.attr("id").split("-header-");t.attr("id",a[0]+"-header-"+e),a=t.attr("aria-controls").split("-panel-"),t.attr("aria-controls",a[0]+"-panel-"+e);t=c(this).find(".ui-accordion-content"),a=t.attr("id").split("-panel-");t.attr("id",a[0]+"-panel-"+e),a=t.attr("aria-labelledby").split("-header-"),t.attr("aria-labelledby",a[0]+"-header-"+e)})},redux.field_objects.repeater.init=function(e){e=e||c(document).find(".redux-group-tab:visible").find(".redux-container-repeater:visible"),c(e).each(function(e){var r,t,n=c(this),a=n;(a=!n.hasClass("redux-field-container")?n.parents(".redux-field-container:first"):a).is(":hidden")||a.hasClass("redux-field-init")&&(a.removeClass("redux-field-init"),r=(a=!(a=n).hasClass("redux-field-container")?n.parents(".redux-field-container:first"):a).attr("data-id"),t=n.find(".redux-repeater-accordion-repeater:last-child"),redux.repeater[r].blank=t.clone().wrap("<p>").parent().html(),a.hasClass("redux-container-repeater")&&a.addClass("redux-field-init"),a.hasClass("redux-field-init")&&(a.removeClass("redux-field-init"),a=n.find(".redux-repeater-accordion").accordion({header:"> div > fieldset > h3",collapsible:!0,activate:function(e,r){c.redux.initFields()},heightStyle:"content",icons:{header:"ui-icon-plus",activeHeader:"ui-icon-minus"}}),1==redux.repeater[r].sortable?a.sortable({axis:"y",handle:"h3",connectWith:".redux-repeater-accordion",placeholder:"ui-state-highlight",start:function(e,r){r.placeholder.height(r.item.height()),r.placeholder.width(r.item.width())},stop:function(e,r){r.item.children("h3").triggerHandler("focusout"),redux.field_objects.repeater.sort_repeaters(c(this))}}):a.find("h3.ui-accordion-header").css("cursor","pointer"),n.find(".redux-repeater-accordion-repeater .bind_title").on("change keyup",function(e){e=0<c(e.target).find(":selected").text().length?c(e.target).find(":selected").text():c(e.target).val(),c(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(e)}),n.on("click",".redux-repeaters-remove",function(){redux_change(c(this));var e=c(this).parents(".redux-container-repeater:first"),r=e.attr("data-id");redux.repeater[r].blank=c(this).parents(".redux-repeater-accordion-repeater:first").clone(!0,!0),c(this).parents(".redux-repeater-accordion-repeater:first").slideUp("medium",function(){c(this).remove(),redux.field_objects.repeater.sort_repeaters(n),""!=redux.repeater[r].limit&&e.find(".redux-repeater-accordion-repeater").length<redux.repeater[r].limit&&e.find(".redux-repeaters-add").removeClass("button-disabled"),e.find(".redux-repeater-accordion-repeater:last .ui-accordion-header").trigger("click")})}),String.prototype.reduxReplaceAll=function(e,r){return this.replace(new RegExp(e.replace(/[.^$*+?()[{\|]/g,"\\$&"),"g"),r)},n.on("click",".redux-repeaters-add",function(){var e,r,t,a,i,d;c(this).hasClass("button-disabled")||(r=(e=c(this).parent().find(".redux-repeater-accordion:first")).find(".redux-repeater-accordion-repeater").length,t=e.attr("data-id"),""!=redux.repeater[t].limit&&r>=redux.repeater[t].limit?c(this).addClass("button-disabled"):(r++,a=e.find(".redux-repeater-accordion-repeater").length,e.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").hasClass("ui-state-active")&&e.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").trigger("click"),0==(d=e.find(".redux-repeater-accordion-repeater:last").clone(!0,!0)).length&&(d=redux.repeater[t].blank),redux.repeater[t]&&(redux.repeater[t].count=n.find(".redux-repeater-header").length,i=redux.repeater[t].html.reduxReplaceAll("99999",a),c(d).find(".redux-repeater-header").text("")),d.find(".ui-accordion-content").html(i),c(e).append(d),redux.field_objects.repeater.sort_repeaters(d),(d=c(this).parent().find(".redux-repeater-accordion:first")).find(".redux-repeater-accordion-repeater:last .ui-accordion-header").trigger("click"),d.find(".redux-repeater-accordion-repeater:last .bind_title").on("change keyup",function(e){e=0<c(e.target).find(":selected").text().length?c(e.target).find(":selected").text():c(e.target).val(),c(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(e)}),0<redux.repeater[t].limit&&r>=redux.repeater[t].limit&&c(this).addClass("button-disabled")))})))})}}(jQuery);
